<p-drawer
  header="Properties Filter"
  [(visible)]="asideVisible"
  styleClass="!w-full md:!w-80 lg:!w-[30rem]"
>
  <div class="content flex items-center flex-wrap gap-4 py-4">
    <p-select
      [options]="cities"
      [(ngModel)]="selectedCity"
      (ngModelChange)="onSelectCity($event)"
      [checkmark]="true"
      optionLabel="name"
      [showClear]="true"
      placeholder="Select a City"
      class="w-full"
      appendTo="body"
    />
    <p-multiselect
      [options]="propertyTypes"
      [(ngModel)]="selectedPropertyType"
      [disabled]="!selectedCity().code"
      placeholder="Property Type"
      styleClass=""
      class="w-full"
      (ngModelChange)="onPropertyTypeChange($event)"
      appendTo="body"
    />

    <p-select
      [options]="bedrooms"
      [(ngModel)]="selectedBedroom"
      (ngModelChange)="selectBedroom($event)"
      [checkmark]="true"
      [showClear]="true"
      placeholder="Bedrooms"
      appendTo="body"
      class="w-full"
    />

    <p-select
      [options]="sortOptions"
      [(ngModel)]="sortBy"
      [checkmark]="true"
      optionLabel="label"
      [showClear]="true"
      placeholder="Order By "
      class="w-full"
      appendTo="body"
    />
    <div class="price relative">
      <div class="flex justify-between overflow-hidden gap-2">
        <p-floatlabel variant="in">
          <input
            pInputText
            id="in_label"
            type="text"
            [(ngModel)]="filters.min_price"
            autocomplete="off"
            class="w-full pt-[15px] rounded-2xl px-2 border-1 border-gray-300 outline-gray-300"
          />
          <label for="in_label">Min Price</label>
        </p-floatlabel>
        <span class="opacity-30 translate-y-[10px]">____</span>
        <p-floatlabel variant="in">
          <input
            pInputText
            id="in_label"
            type="text"
            autocomplete="off"
            [(ngModel)]="filters.max_price"
            class="w-full pt-[15px] border-1 border-gray-300 outline-gray-300 rounded-2xl px-2"
          />
          <label for="in_label">Max Price</label>
        </p-floatlabel>
      </div>
    </div>
    <button
      (click)="getProperties()"
      class="block py-2 px-6 rounded text-white bg-secondary w-fit transition-colors hover:bg-head"
    >
      Find
    </button>
  </div></p-drawer
>
<button
  class="px-[1.5px] py-2 rounded text-white bg-secondary transition-colors hover:bg-head mt-5 fixed left-0 top-[50%] translate-y-[-50%] z-50"
  (click)="asideVisible = true"
>
  <i class="fa-solid fa-sliders"></i> Filters
</button>
<div class="container mx-auto">
  <div class="page-result grid grid-cols-12 my-5 min-h-[100vh]">
    <h3
      class="font-medium text-[20px] city-name col-span-12 flex justify-center"
    >
      Properties for sale in {{ selectedCity().name }}
    </h3>
    <div
      class="title-sort col-span-12 flex justify-between items-center p-2 my-2"
    ></div>
    <div class="properties grid col-span-7 gap-8">
      @for (prop of properties(); track prop.id) {
      <a [routerLink]="['/propertyDetails', prop.id]">
        <div class="property rounded-2xl overflow-hidden mx-2">
          <div class="property-details flex-wrap grid grid-cols-8">
            <img
              [src]="prop.propertyImages.mainImageSrc"
              alt=""
              class="w-full object-cover h-[250px] col-span-8 sm:col-span-4 md:col-span-5"
            />
            <div
              class="info flex-1 px-4 py-2 flex gap-2 col-span-8 sm:col-span-4 md:col-span-3"
            >
              <div class="property-info flex-1 flex justify-between flex-col">
                <img
                  [src]="prop.customer.brandPlusLogoUrl"
                  alt="logo"
                  class="rounded w-[60px] self-end"
                />
                <div class="price-info flex flex-col gap-2">
                  <span class="opacity-70">{{ prop.propertySubType }}</span>
                  <h3 class="text-[18px] font-bold">
                    {{ prop.price.displayPrices[0].displayPrice }}
                  </h3>
                  <p class="opacity-70">{{ prop.displayAddress }}</p>
                </div>
                <div class="details flex gap-2 text-sm mt-2 text-gray-700">
                  <div>
                    <span><i class="fa-solid fa-bed"></i></span>
                    <span> {{ prop.bedrooms }}</span>
                  </div>
                  <div>
                    <span><i class="fa-solid fa-bath"></i></span>
                    <span>{{ prop.bathrooms }}</span>
                  </div>

                  <span class="flex items-center gap-1">
                    <span>
                      <svg
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        class="styles-module_content__details-icon__Hjx-H"
                      >
                        <path
                          fill-rule="evenodd"
                          clip-rule="evenodd"
                          d="M6 19.2563L7.14783 18.1236C7.34385 17.9292 7.66043 17.9304 7.85493 18.1263C8.04943 18.3222 8.04819 18.6386 7.85217 18.833L5.85217 20.8084C5.65723 21.0017 5.34277 21.0017 5.14783 20.8084L3.14783 18.833C2.95181 18.6386 2.95057 18.3222 3.14507 18.1263C3.33957 17.9304 3.65615 17.9292 3.85217 18.1236L5 19.2563V9.6821L3.85217 10.8148C3.65615 11.0092 3.33957 11.008 3.14507 10.8121C2.95057 10.6162 2.95181 10.2998 3.14783 10.1054L5.14783 8.13006C5.34277 7.93677 5.65723 7.93677 5.85217 8.13006L7.85217 10.1054C8.04819 10.2998 8.04943 10.6162 7.85493 10.8121C7.66043 11.008 7.34385 11.0092 7.14783 10.8148L6 9.6821V19.2563ZM9.70978 5.99806L10.8433 7.14514C11.0378 7.34104 11.0365 7.65741 10.8405 7.85179C10.6445 8.04616 10.3279 8.04492 10.1334 7.84902L8.15674 5.85032C7.96332 5.65551 7.96332 5.34125 8.15674 5.14644L10.1334 3.14773C10.3279 2.95184 10.6445 2.9506 10.8405 3.14497C11.0365 3.33935 11.0378 3.65572 10.8433 3.85162L9.70978 4.9987H19.2902L18.1567 3.85162C17.9622 3.65572 17.9635 3.33935 18.1595 3.14497C18.3555 2.9506 18.6721 2.95184 18.8666 3.14773L20.8433 5.14644C21.0367 5.34125 21.0367 5.65551 20.8433 5.85032L18.8666 7.84902C18.6721 8.04492 18.3555 8.04616 18.1595 7.85179C17.9635 7.65741 17.9622 7.34104 18.1567 7.14514L19.2902 5.99806H9.70978ZM21 19.0013C21 20.1052 20.1046 21 19 21H11C9.89543 21 9 20.1052 9 19.0013V11.0065C9 9.90263 9.89543 9.00778 11 9.00778H19C20.1046 9.00778 21 9.90263 21 11.0065V13.0052H20V11.0065C20 10.4546 19.5523 10.0071 19 10.0071H11C10.4477 10.0071 10 10.4546 10 11.0065V19.0013C10 19.5532 10.4477 20.0006 11 20.0006H19C19.5523 20.0006 20 19.5532 20 19.0013H21ZM21 17.0026H20V15.0039H21V17.0026Z"
                          fill="currentColor"
                        ></path>
                      </svg>
                    </span>
                    <span>{{ prop.displaySize }}</span>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div
            class="property-footer bg-gray-50 p-2 relative flex justify-between items-center flex-wrap gap-1"
          >
            <span class="text-[14px] opacity-70">{{
              prop.firstVisibleDate | date
            }}</span>
            <div class="contact flex gap-2">
              <a
                (click)="toggleNumber()"
                class="flex justify-center items-center select-none py-1 px-2 rounded text-[#3a307f] border border-[#3a307f] transition-all hover:bg-[#3a307f] hover:text-white"
              >
                <span class="flex justify-between">
                  <span><i class="fa-solid fa-phone"></i></span>
                  <span>
                    @if(showNumber) {
                    {{ prop.customer.contactTelephone }}
                    } @else { Call }
                  </span>
                </span>
              </a>
              <a
                href="https://wa.me/201210886136"
                target="_blank"
                class="flex justify-center items-center select-none py-1 px-2 rounded text-[#3a307f] border border-[#3a307f] transition-all hover:bg-[#3a307f] hover:text-white"
              >
                <span> <i class="fa-brands fa-whatsapp"></i> </span>
                <span>WhatsApp</span>
              </a>
              <span class="w-[1.5px] bg-gray-200 block"></span>
              <div class="flex justify-between share gap-2">
                <a
                  class="text-[18px] flex justify-center items-center select-none py-1 px-2 rounded text-[#3a307f] border border-[#3a307f] transition-all hover:bg-[#3a307f] hover:text-white"
                >
                  <span><i class="fa-regular fa-heart"></i></span>
                </a>
                <a
                  pTooltip="Add To Compare"
                  tooltipPosition="bottom"
                  class="text-[18px] flex justify-center items-center py-1 px-2 rounded text-[#3a307f] border border-[#3a307f] hover:bg-[#3a307f] hover:text-white"
                  (click)="_service.AddToCompare(prop)"
                >
                  <i class="fa-solid fa-plus"></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </a>
      }
    </div>
    <div class="map col-span-5 min-w-[200px] h-[600px]" id="map"></div>
  </div>
  <p-paginator
    (onPageChange)="onPageChange($event)"
    [first]="first"
    [rows]="rows"
    [totalRecords]="totalRecords"
  />
</div>
<p-dialog
  header="Apartment Details"
  [(visible)]="modalVisible"
  [style]="{ width: '32rem' }"
  [modal]="true"
  [dismissableMask]="true"
>
  <p-card class="shadow-2 border-round-lg overflow-hidden">
    <img
      [src]="modalProperty?.propertyImages?.mainImageSrc"
      alt="Apartment Image"
      class="w-full h-64 object-cover"
    />

    <div class="p-4">
      <div class="flex justify-between items-center mb-3">
        <h2 class="text-xl font-semibold m-0">
          {{ modalProperty?.displayAddress }}
        </h2>
        <span class="text-green-600 text-lg font-bold">
          ${{ modalProperty?.price?.amount }}
        </span>
      </div>

      <p class="m-0 text-sm text-gray-600 mb-2">
        üõèÔ∏è Beds: {{ modalProperty?.bedrooms }}
      </p>

      <p class="m-0 text-gray-700 mb-4">
        {{ modalProperty?.summary }}
      </p>

      <a pButton label="View Details" class="w-full" target="_blank"></a>
    </div>
  </p-card>
</p-dialog>
